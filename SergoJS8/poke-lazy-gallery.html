<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="poke-lazy-gallery.css">
</head>

<body>
    <div id="gallery">
    </div>
    <script>
        const gallery = document.getElementById("gallery");
        var currentId = 1;
        var isLoading = false;

        async function fetchPokemon(id) {
            const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
            if (!response.ok) {
                throw new Error(`Network response is not ok!`)

            }
            const pokemon = await response.json();
            console.log(pokemon);
            return pokemon;
        }


        async function loadPokemon() {
            
            if(isLoading) return;
            
            isLoading = true;
            
            const pokemon = await fetchPokemon(currentId);

            const pokemonContainer = document.createElement("div");
            pokemonContainer.className = "pokemon-container";
            gallery.appendChild(pokemonContainer);


            const pokemonImage = document.createElement("img");
            pokemonImage.className = "image-container";
            pokemonImage.src = pokemon.sprites.front_default;
            pokemonContainer.appendChild(pokemonImage);


            const pokemonText = document.createElement("div")
            pokemonText.className = "text-container"
            pokemonContainer.appendChild(pokemonText);
            pokemonText.innerHTML = `<p><strong>${pokemon.name}</strong> (ID: ${pokemon.id})</p>`;
            currentId++;
            isLoading = false;
        }

        async function loadPackPokemon(count) {

            for (let i = 1; i < count; i++) {
                await loadPokemon();

            }

        }
        loadPackPokemon(7);
        window.addEventListener("scroll",
            () => {
                console.log("SCROLL!");
                console.log("window.innerHeight", window.innerHeight);
                console.log("windows.scrollY", window.scrollY);
                console.log("document.offsetHeight", document.body.offsetHeight)
                if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500){
                    loadPokemon();
                }

            }
        )

    </script>

</body>

</html>
